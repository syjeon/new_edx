// Generated by CoffeeScript 1.6.3
(function() {
  describe('Calculator', function() {
    beforeEach(function() {
      loadFixtures('calculator.html');
      return this.calculator = new Calculator;
    });
    describe('bind', function() {
      it('bind the calculator button', function() {
        return expect($('.calc')).toHandleWith('click', this.calculator.toggle);
      });
      it('bind the help button', function() {
        expect($('div.help-wrapper a')).toHandleWith('mouseover', this.calculator.helpToggle);
        return expect($('div.help-wrapper a')).toHandleWith('mouseout', this.calculator.helpToggle);
      });
      it('prevent default behavior on help button', function() {
        $('div.help-wrapper a').click(function(e) {
          return expect(e.isDefaultPrevented()).toBeTruthy();
        });
        return $('div.help-wrapper a').click();
      });
      it('bind the calculator submit', function() {
        return expect($('form#calculator')).toHandleWith('submit', this.calculator.calculate);
      });
      return it('prevent default behavior on form submit', function() {
        jasmine.stubRequests();
        $('form#calculator').submit(function(e) {
          expect(e.isDefaultPrevented()).toBeTruthy();
          return e.preventDefault();
        });
        return $('form#calculator').submit();
      });
    });
    describe('toggle', function() {
      it('focuses the input when toggled', function() {
        var didFocus;
        didFocus = false;
        runs(function() {
          spyOn($.fn, 'focus').andCallFake(function(elementName) {
            return didFocus = true;
          });
          return this.calculator.toggle(jQuery.Event("click"));
        });
        waitsFor((function() {
          return didFocus;
        }), "focus() should have been called on the input", 1000);
        return runs(function() {
          return expect($('#calculator_wrapper #calculator_input').focus).toHaveBeenCalled();
        });
      });
      return it('toggle the close button on the calculator button', function() {
        this.calculator.toggle(jQuery.Event("click"));
        expect($('.calc')).toHaveClass('closed');
        this.calculator.toggle(jQuery.Event("click"));
        return expect($('.calc')).not.toHaveClass('closed');
      });
    });
    describe('helpToggle', function() {
      return it('toggle the help overlay', function() {
        this.calculator.helpToggle();
        expect($('.help')).toHaveClass('shown');
        this.calculator.helpToggle();
        return expect($('.help')).not.toHaveClass('shown');
      });
    });
    return describe('calculate', function() {
      beforeEach(function() {
        $('#calculator_input').val('1+2');
        spyOn($, 'getWithPrefix').andCallFake(function(url, data, callback) {
          return callback({
            result: 3
          });
        });
        return this.calculator.calculate();
      });
      it('send data to /calculate', function() {
        return expect($.getWithPrefix).toHaveBeenCalledWith('/calculate', {
          equation: '1+2'
        }, jasmine.any(Function));
      });
      return it('update the calculator output', function() {
        return expect($('#calculator_output').val()).toEqual('3');
      });
    });
  });

}).call(this);
